Perform a repository health audit to detect issues that indicate Claude may be going off track.

# Health Checks

Perform the following checks:

1. **Missing Claude footers**: Check if any issues or PRs with the `claude` label have descriptions or comments missing the Claude footer ("âœ¨ Content generated by Claude AI.")

2. **Multiple consecutive Claude comments**: Look for PRs or issues where Claude has posted 3+ consecutive comments without user input between them

3. **Orphaned PRs**: Find open PRs that reference closed issues (these should have been auto-closed by GitHub)

4. **Label inconsistencies**: Identify PRs without the `claude` label that close issues with the `claude` label

5. **Discuss issues with multiple Claude comments**: Find issues with the `discuss` label where Claude has commented multiple times without the label being removed

# Self-Healing Actions

Before reporting issues, attempt to fix these automatically:

1. **Add missing Claude footers**: If a comment or description is missing the footer, add it
2. **Add `input required` label**: If a PR has multiple consecutive Claude comments without user response, add the label
3. **Close orphaned issues**: If an issue has a merged PR addressing it but wasn't auto-closed, close it
4. **Fix label inconsistencies**: Add `claude` label to PRs that close `claude`-labeled issues

# Issue Reporting

After attempting self-healing:

1. **Check for existing audit issues**: Query open issues with both `claude` and `discuss` labels
2. **Deduplicate**: If a similar issue already exists, add a comment to that issue instead of creating a new one
3. **Create new issue if needed**: If no similar issue exists, create a new discuss issue with:
   - Title: "Audit: [Brief description of problems found]"
   - Labels: `claude`, `discuss`
   - Description: Detailed list of problems and recommended remediation
   - Initial comment with Claude footer to signal awaiting response

# Critical Issues

Track critical issues that may require machine pause (if AUDIT_CAN_PAUSE_MACHINE=true):

- Claude creating issues/PRs that violate workflow rules (e.g., working on blocked issues)
- Multiple simultaneous PRs for the same issue
- Repeated workflow violations within 24 hours

If critical issues persist (3+ occurrences within 24 hours) and machine pause is enabled:
1. Send Discord notification explaining the reason for pausing
2. Create audit issue documenting the problem
3. Execute: fly machine stop $FLY_MACHINE_ID

# Output Format

Provide a concise summary of:
- Number of issues found in each category
- Self-healing actions taken
- Whether a new audit issue was created or existing issue was updated
- Any critical issues requiring attention
