# Claude Instructions

## About This Document

**Scope:** These are universal guidelines that apply to all Claude AI work on this repository, regardless of which mode of operation is being used (Claude Desktop, autonomous Claude Code, or interactive Claude Code).

---

* Use `Claude Code` as the Git user name and `herve.quiroz+claude@gmail.com` as the user email address.
* Do not add a "Co-Authored-By:" entry in the commit messages.

## Commit Configuration

**IMPORTANT**: Always use these exact values for commits:
* Author Name: Claude Code
* Author Email: `herve.quiroz+claude@gmail.com`

⚠️ **Common Mistake**: Do NOT add `Co-Authored-By: Claude <noreply@anthropic.com>` in the commit message

## Pre-Commit Checklist

Before making any commits, verify:
- [ ] Author email is `herve.quiroz+claude@gmail.com`
- [ ] Branch name follows `claude/description` pattern
- [ ] Commit message is descriptive
- [ ] Commit message formatting is correct (no literal `\n` characters, proper line breaks)
- [ ] All tests pass if applicable

## Commit Message Validation

When creating commit messages through the GitHub API, ensure:
- [ ] Use actual newline characters, not escaped `\n` sequences
- [ ] Multi-line messages have proper formatting
- [ ] No visible `\n` characters appear in the final commit message
- [ ] Message follows repository commit conventions
- [ ] Do NOT add a `Co-Authored-By:` entry in the commit message

**Example of correct multi-line commit message formatting:**
```
Add feature X to improve Y

- Add new functionality for better user experience
- Include proper error handling and validation
- Update tests to cover new scenarios

This change addresses the requirements outlined in issue #123
and improves the overall reliability of the system.
```

## Branches

* Branch naming: `claude/description`
* When working on branch to address an issue: `claude/fix-<issue_number>` or `claude/issue-<issue_number>`

## Pull requests

* Pull requests should only be sent for review after all tests pass and quality checks succeed.
* When checking for errors or warnings from Github actions, look into warnings that don't necessarily cause the action to fail.
* Do not merge pull requests yourself. Pull requests should be approved by the owner of the repository.
* Pull requests created by Claude should have the `claude` label.
* Pull requests created to address a given issue should contain `fixes #123` (with the right issue number) in their descriptions so that merging the pull request automatically closes the issue. See [Linking a pull request to an issue](https://docs.github.com/en/issues/tracking-your-work-with-issues/using-issues/linking-a-pull-request-to-an-issue) for details.

### PR Description Template

When creating a PR, include:
- Summary of changes
- Testing approach
- Related issues (use `fixes #123` format)

## Branch Management

* ALWAYS create a new branch for each task/issue
* NEVER reuse branches that have already been merged
* Branch naming convention: `claude/issue-{issue-number}` or `claude/{descriptive-name}`
* Before starting work, check out main and create a fresh branch from it

## When working on a Github issue

* Create a pull request with the branch naming convention above
* Add the `claude` label to the pull request
* Describe your approach in the pull request description
* Make sure all tests pass and then mark the pull request as ready for review

## Comments (Github issues and pull requests)

⚠️ **CRITICAL**: ALL Claude-generated content on GitHub MUST include the footer below. This includes:
- PR descriptions
- Issue comments
- PR comments
- Review responses
- Any other text posted to GitHub

Add the following footer to identify Claude-generated content easily:

```
---
✨ Content generated by Claude AI.
```

## Planning without timelines

When planning tasks, provide concrete implementation steps without time estimates. Never suggest timelines like "this will take 2-3 weeks" or "we can do this later." Focus on what needs to be done, not when. Break work into actionable steps and let users decide scheduling.

**Examples:**

❌ **Don't:**
- "This will take approximately 2-3 days of focused work"
- "Implementation estimate: ~1 week"
- "We can tackle this in the next sprint"

✅ **Do:**
- "This requires changes to: configuration handling, work detection logic, and workspace management"
- "Implementation involves: parsing new environment variable, updating repository selection logic, and adding tests"
- Focus on technical scope and complexity, not duration

## Track issues and blockers

* When blocked in your development because you're missing some capability (e.g. MCP server or access to a specific development tool in your environment), create an issue in this Github repository to describe what's missing
* The issue title should contain `[Claude]` as a prefix. e.g. `[Claude] Missing tool: <some_tool>`
* Check beforehand that a similar issue does not exist. If one does exist, consider adding additional context and information based on the current task at hand
* Avoid duplicate content in the Github issue as this will be read by humans. Consider editing existing comments to refine the explanations rather than adding new comments
* Do not apply the `claude` tag to the issue yourself
* Remember to use the same footer as for other discussions to indicate that the issue content or comment was generated by Claude

## Clean-up changes

* When removing logic, don't leave comments about it. If things don't exist, we don't need to mention them

## Label-Based Work Control

### Required Labels for Claude Work
- **`claude`** - Issue is assigned to Claude for implementation
- **NOT `blocked`** - Issue dependencies are satisfied and work can begin

### Blocked Label Usage
The `blocked` label indicates that an issue has unmet dependencies and should not be worked on yet:

- **NEVER work on issues with the `blocked` label**, even if they also have the `claude` label
- Issues become unblocked when their dependencies are completed (dependencies will be listed in the issue description)
- When checking for available work, use: `gh issue list --label claude --label "!blocked"`
- If all `claude` issues are `blocked`, no work should be started - wait for dependencies to be completed

### Dependency Management
- Issues with dependencies will initially have both `claude` and `blocked` labels
- When prerequisite issues are completed, the `blocked` label should be removed from dependent issues
- This ensures proper ordering for complex features with multiple interdependent components

## Creating and managing Github issues

* NEVER add the `claude` label on a Github issue yourself unless it's requested explicitly
* NEVER work on an issue that depends on functionality added by another open issue. Instead, skip it until the other issue is closed

## Special Issue Types

### Design Issues

Issues labeled with `design` are for design discussions and planning, not immediate implementation.

- **`design`** label indicates an issue is about discussing and documenting design decisions
- Design issues focus on planning, architecture, and requirements gathering
- Design work results in documentation updates, commits go directly to main (no PR needed)
- Once design is finalized, implementation issues can be created based on the design decisions

For detailed workflow steps, see the `find-work` skill's `references/design-workflow.md`.

### Discuss Issues

Issues labeled with `discuss` are for lightweight Q&A and clarification within the issue thread itself.

- **`discuss`** label indicates an issue needs clarification before implementation
- Discussion happens entirely within the issue (no code changes, no branches)
- Claude updates the issue description and posts summary comments
- Once `discuss` label is removed, the issue transitions to normal implementation

For detailed workflow steps, see the `find-work` skill's `references/discuss-workflow.md`.

### Documentation Issues (No Label Required)

Some issues request documentation updates rather than code implementation. These can be identified by **signals in the issue title or body**, even without a special label.

**Strong indicators (any one = treat as documentation issue):**

1. **Title starts with:** `Design:` or `Plan:` (case-insensitive)
2. **Body starts with:** `Doc:`, `Docs:`, `Document:`, or `Documents:` (case-insensitive) followed by a file path in backticks

**Supporting indicators (consider in context):**

3. Title contains words like "design", "document", "documentation", "spec", "specification", "plan", "planning"
4. Body references markdown files (`.md`) as the primary subject
5. Issue describes what to capture/record/document rather than what to build/implement

**Behavior for documentation issues:**

- The deliverable is **updating documentation**, not writing code
- Look for the referenced doc file path (e.g., `` Doc: `doc/gameplay.md` ``) to know where changes go
- If no explicit path, infer from context or ask for clarification
- **Create a PR** with documentation changes (do NOT commit directly to main)
- PR title and description should reflect documentation work, not implementation

**When signals are ambiguous:**

If an issue has mixed signals (e.g., title says "Design" but body describes implementation tasks), **post a clarifying comment** on the issue before starting work. Ask whether the expected deliverable is documentation updates or code implementation.

**Examples:**

| Issue Title | Body Starts With | Interpretation |
|-------------|------------------|----------------|
| "Design: equipment system" | `Doc: \`doc/gameplay.md\`` | Documentation issue |
| "Plan: save game format" | `Documents: \`doc/serialization.md\`` | Documentation issue |
| "Add inventory management" | Implementation details | Code implementation |
| "Design: new feature" | Code snippets, no doc reference | Ambiguous - ask for clarification |

### Label Precedence

- **`blocked`** label always takes precedence - never work on blocked issues regardless of other labels
- If an issue has both `discuss` and `design` labels, treat it as a `discuss` issue
- Documentation issues (detected by title/body signals) take precedence over assuming code implementation

## Repository-Specific Guidelines

This repository contains artefacts for visual testing from various projects.
